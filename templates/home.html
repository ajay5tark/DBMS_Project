<!DOCTYPE html>
<html>

<head>
    <title>Welcome {{name}}</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="w-100 d-flex justify-content-end p-3">
        <button class="btn btn-danger" onclick="location.href = '/login';">Logout</button>
    </div>
    <div class="w-100 text-center px-5">
        <h3 class="sans">{{user_data[0]}}</h3>
        <h3 class="sans">{{user_data[1]}}</h3>
        <form action="/searchPatient">
            <input type="hidden" name="name" value="{{user_data[0]}}" placeholder="">
            <input type="hidden" name="type" value="{{user_data[1]}}" placeholder="">
            <input type="hidden" name="ID" value="{{user_data[2]}}" placeholder="">
            <button id="patientbutton" type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
    {% if user_data[1]=="Patient" %} {%if data%}
    <div class="container p-3">
        <h4 class="text-primary">Your Medical History is :</h4>
        <input class="m-3" type="text" id="myInput" onkeyup="myFunction()" placeholder="Search Disease" title="Disease Name">
        <table id="Table1" class="table table-bordered table-striped table-dark">
            <thead>
                <tr>
                    <th scope="col">No.</th>
                    <th scope="col">Disease Name</th>
                    <th scope="col">Doctor Name</th>
                    <th scope="col">Detection Date</th>
                    <th scope="col">Treatment End Date</th>
                    <th scope="col">Hospital</th>
                    <th scope="col">Test Name</th>
                    <th scope="col">Lab Name</th>
                    <th scope="col">Amount</th>
                </tr>
            </thead>
            <tbody>
                {%for item in data%}
                <tr>
                    <td>{{loop.index}}</td>
                    <td>{{item[0]}}</td>
                    <td>{{item[1]}}</td>
                    <td>{{item[2]}}</td>
                    <td>{{item[3]}}</td>
                    <td>{{item[4]}}</td>
                    <td>{{item[5]}}</td>
                    <td>{{item[6]}}</td>
                    <td>{{item[7]}}</td>
                </tr>
                {%endfor%}
            </tbody>
        </table>
    </div>
    {%endif%} {%endif%}
</body>

<style>
    .sans {
        color: #82ccdd;
        font-family: 'Source Sans Pro', sans-serif;
    }
    
    body {
        background-color: #181828;
    }
    
    th {
        cursor: pointer;
    }
</style>
<script src="https://www.w3schools.com/lib/w3.js"></script>
<link href="https://www.w3schools.com/w3css/4/w3.css" rel="stylesheet" />

<script>
    const table = document.querySelector('#Table1'); //get the table to be sorted
    //const table2 = document.querySelector('#Table2');

    table.querySelectorAll('th') // get all the table header elements
        .forEach((element, columnNo) => { // add a click handler for each 
            element.addEventListener('click', event => {
                sortTable(table, columnNo); //call a function which sorts the table by a given column number
            })
        })

    function sortTable(table, sortColumn) {
        // get the data from the table cells
        const tableBody = table.querySelector('tbody')
        const tableData = table2data(tableBody);
        // sort the extracted data
        tableData.sort((a, b) => {
                if (a[sortColumn] > b[sortColumn]) {
                    return 1;
                }
                return -1;
            })
            // put the sorted data back into the table
        data2table(tableBody, tableData);
    }
    // this function gets data from the rows and cells 
    // within an html tbody element
    function table2data(tableBody) {
        const tableData = []; // create the array that'll hold the data rows
        tableBody.querySelectorAll('tr')
            .forEach(row => { // for each table row...
                const rowData = []; // make an array for that row
                row.querySelectorAll('td') // for each cell in that row
                    .forEach(cell => {
                        rowData.push(cell.innerText); // add it to the row data
                    })
                tableData.push(rowData); // add the full row to the table data 
            });
        return tableData;
    }

    // this function puts data into an html tbody element
    function data2table(tableBody, tableData) {
        tableBody.querySelectorAll('tr') // for each table row...
            .forEach((row, i) => {
                const rowData = tableData[i]; // get the array for the row data
                row.querySelectorAll('td') // for each table cell ...
                    .forEach((cell, j) => {
                        cell.innerText = rowData[j]; // put the appropriate array element into the cell
                    })
                tableData.push(rowData);
            });
    }
</script>

<script>
    function myFunction() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("Table1");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[1];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
</script>

</html>